C51 COMPILER V9.00   UARTDRV                                                               06/12/2019 17:22:58 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE UARTDRV
OBJECT MODULE PLACED IN ..\bin\uartDrv.obj
COMPILER INVOKED BY: C:\Program Files\Keil\C51\BIN\C51.EXE ..\src\drv\uartDrv.c BROWSE DEBUG OBJECTEXTEND PRINT(.\uartDr
                    -v.lst) OBJECT(..\bin\uartDrv.obj)

line level    source

   1          /* 
   2             -----------------------------------------------------------------------
   3             Author   - Tiger.Xu
   4             Date     - 2019.06.08
   5             Version  - 0.0.1
   6          
   7             Change Notes:
   8                  2019.06.08      Tiger.Xu
   9                  Initial version
  10          
  11                  ...             ...
  12                  ...
  13              
  14             Description:
  15                  Use one level fifo buffer when receive and transmit data in byte
  16                  level
  17             -----------------------------------------------------------------------
  18          */
  19          
  20          #include "uartDrv.h"
*** ERROR C141 IN LINE 24 OF ..\SRC\DRV\UARTDRV.H: syntax error near ','
*** ERROR C141 IN LINE 25 OF ..\SRC\DRV\UARTDRV.H: syntax error near ','
  21          
  22          uartSts_type uartGlobalSts;
  23          fifo_type uartTxFifo_Obj[max_networkChannel];
  24          fifo_type uartRxFifo_Obj[max_networkChannel];
  25          
  26          /* This function should be called cyclic in TODO: ??? ms
  27             and should be invoke in a faster scheduling rate than
  28             setUartSendBuf
  29           */
  30          static void sendDataCyclic()
  31          {
  32   1          unsigned int data;
*** ERROR C141 IN LINE 32 OF ..\SRC\DRV\UARTDRV.C: syntax error near ';'
  33   1          networkChannel_type i = 0;
*** ERROR C141 IN LINE 33 OF ..\SRC\DRV\UARTDRV.C: syntax error near 'networkChannel_type'
*** ERROR C202 IN LINE 33 OF ..\SRC\DRV\UARTDRV.C: 'i': undefined identifier
  34   1          for(i = 0; i < max_networkChannel; i ++)
*** ERROR C202 IN LINE 34 OF ..\SRC\DRV\UARTDRV.C: 'i': undefined identifier
  35   1          {
  36   2              if(uartTxFifo_Obj[i].curPtr > 0)
*** ERROR C202 IN LINE 36 OF ..\SRC\DRV\UARTDRV.C: 'i': undefined identifier
  37   2              {
  38   3                  /* If the Tx FIFO buffer has data to send then put
  39   3                     the send data into data register
  40   3                   */
  41   3                  if(uartGlobalSts != uartSts_busy)
  42   3                  {
  43   4                      uartGlobalSts = uartSts_busy;
  44   4                      getFifoData(&uartTxFifo_Obj[i], &data);
*** ERROR C202 IN LINE 44 OF ..\SRC\DRV\UARTDRV.C: 'i': undefined identifier
*** ERROR C141 IN LINE 44 OF ..\SRC\DRV\UARTDRV.C: syntax error near 'data'
  45   4                      SBUF = data;
C51 COMPILER V9.00   UARTDRV                                                               06/12/2019 17:22:58 PAGE 2   

*** ERROR C141 IN LINE 45 OF ..\SRC\DRV\UARTDRV.C: syntax error near 'data'
  46   4                  }
  47   3              }
  48   2          }
  49   1      }
  50          
  51          void uartDrvInit()
  52          {
  53   1          unsigned char i;
  54   1          /* TODO: Configure the uart register */
  55   1      
  56   1      
  57   1          /* Create an FIFO object buffer uart data */
  58   1          for(i = 0; i < max_networkChannel; i ++)
  59   1          {
  60   2              uartTxFifo_Obj[i] = fifoInit(UART_DATA_LEN_IN_BYTE);
  61   2          }
  62   1      }
  63          
  64          void uartDrvUpdate()
  65          {
  66   1      
  67   1      }
  68          
  69          uartSts_type setUartSendBuf(unsigned int *data, networkChannel_type nwChn)
*** ERROR C141 IN LINE 69 OF ..\SRC\DRV\UARTDRV.C: syntax error near ','
  70          {
  71   1          fifoSts_type writeOpsts;
  72   1          uartSts_type returnVal;
  73   1      
  74   1          /* write the data into the send buffer */
  75   1          writeOpsts = setFifoData(&uartTxFifo_Obj[nwChn], data);
*** ERROR C141 IN LINE 75 OF ..\SRC\DRV\UARTDRV.C: syntax error near 'data'
  76   1          if(writeOpsts == writeSuccess)
  77   1          {
  78   2              returnVal = uartSts_normal;
  79   2          }
  80   1          else{
  81   2              returnVal = uartSts_sendFail; 
  82   2          }
  83   1          return returnVal;
  84   1      }
  85          
  86          uartSts_type getUartReceiveBuf(unsigned int *data, networkChannel_type nwChn)
  87          {
  88   1          fifoSts_type readOpsts;
  89   1          uartSts_type returnVal;
  90   1      
  91   1          /* Get the data from Rx fifo */
  92   1          readOpsts = getFifoData(&uartRxFifo_Obj[nwChn], data);
  93   1      
  94   1          if(readOpsts == readSuccess)
  95   1          {
  96   2              returnVal = uartSts_normal;
  97   2          }
  98   1          else{
  99   2              returnVal = uartSts_receiveFail;
 100   2          }
 101   1          return returnVal;
 102   1      }
 103          
 104          void uartInterruptService()
C51 COMPILER V9.00   UARTDRV                                                               06/12/2019 17:22:58 PAGE 3   

 105          {
 106   1          /* TODO this interrupt shoud be copy for two channel */
 107   1          unsigned char data;
 108   1          if (RI)
 109   1          {
 110   2              RI = 0;
 111   2      
 112   2              data = SBUF;
 113   2              /* Put the data into the Rx FIFO */                 
 114   2                      setFifoData(&uartRxFifo_Obj[0], &data);
 115   2          }
 116   1          if (TI)
 117   1          {
 118   2              TI = 0;
 119   2              uartGlobalSts = uartSts_normal;                 
 120   2          }
 121   1      }
 122          
 123          unsigned char isUartNewDataAvailable(networkChannel_type nwChn)
 124          {
 125   1          if(uartRxFifo_Obj[nwChn].curPtr > 0)
 126   1          {
 127   2              return 1;
 128   2          }
 129   1          else
 130   1          {
 131   2              return 0;
 132   2          }
 133   1      }

C51 COMPILATION COMPLETE.  0 WARNING(S),  12 ERROR(S)
