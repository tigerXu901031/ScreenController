C51 COMPILER V9.00   UART                                                                  06/06/2019 08:04:35 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN ..\bin\UART.obj
COMPILER INVOKED BY: C:\Program Files\Keil\C51\BIN\C51.EXE ..\src\UART.C BROWSE DEBUG OBJECTEXTEND PRINT(.\UART.lst) OBJ
                    -ECT(..\bin\UART.obj)

line level    source

   1          #include "UART.h"
   2          
   3          unsigned char date;
   4          bit RX_OK;
   5          bit busy;
   6          
   7          //功能：延时子程序  参数：time  为多少ms。
   8          void delay_ms(unsigned int time)
   9          {
  10   1               unsigned int i;
  11   1               unsigned int j;
  12   1               for(i=0;i<time;i++)
  13   1                      for(j=0;j<1000;j++);
  14   1      }
  15          
  16          void UART_INIT()                //9600bps@11.0592MHz
  17          {
  18   1                      SCON = 0x50;            //8位数据,可变波特率
  19   1                      AUXR |= 0x01;           //串口1选择定时器2为波特率发生器
  20   1                      AUXR |= 0x04;           //定时器2时钟为Fosc,即1T
  21   1                      T2L = 0xE0;             //设定定时初值
  22   1                      T2H = 0xFE;             //设定定时初值
  23   1                      AUXR |= 0x10;           //启动定时器2
  24   1          ES = 1;                     //使能串口中断
  25   1          EA = 1;     
  26   1      }
  27          
  28          /*----------------------------
  29          发送串口数据
  30          ----------------------------*/
  31          void SendData(unsigned char dat)
  32          {
  33   1          while (busy);               //等待前面的数据发送完成
  34   1          busy = 1;
  35   1          SBUF = dat;                 //写数据到UART数据寄存器          
  36   1      }
  37          
  38          /*----------------------------
  39          发送串口数据 -- > 接收数据转发
  40          ----------------------------*/
  41          void SendData1(unsigned char dat)
  42          {
  43   1      
  44   1          SBUF = dat;                 //写数据到UART数据寄存器          
  45   1      }
  46          
  47          
  48          /*----------------------------
  49          发送字符串
  50          ----------------------------*/
  51          void SendString(char *s)
  52          {
  53   1          while (*s)                  //检测字符串结束标志
  54   1          {
C51 COMPILER V9.00   UART                                                                  06/06/2019 08:04:35 PAGE 2   

  55   2              SendData(*s++);         //发送当前字符
  56   2          }
  57   1      }
  58          
  59          
  60          
  61          /*----------------------------
  62          UART 中断服务程序
  63          -----------------------------*/
  64          void Uart() interrupt 4 using 1
  65          {
  66   1                      unsigned char date;
  67   1          if (RI)
  68   1          {
  69   2              RI = 0;                 //清除RI位 
  70   2                                      date = SBUF;
  71   2                                SendData1(date);                                      //将收到的串口数据发回去
  72   2          }
  73   1          if (TI)
  74   1          {
  75   2              TI = 0;                 //清除TI位
  76   2              busy = 0;               //清忙标志
  77   2          }
  78   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    128    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
